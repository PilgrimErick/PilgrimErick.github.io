---
title: 使用Hexo，如何在多台电脑上维护和更新github pages博客
date: 2017-03-23 22:51:40
tags: hexo
reward: true
---

今天在公司用hexo搭好博客之后，突然有个疑问：我想要回到家继续写文章、更新博客，该怎么办呢？一个想法很快跳了出来：

>只要把公司本地博客**根目录**存着的`source/_posts`（文章所在目录）、`_config.yml`（博客配置文件）以及`themes`（主题文件目录）都备份一份（多种方式备份：使用U盘、网盘、GitHub仓库），待回到家之后重新`hexo init`，然后将备份的文件覆盖进去，再`hexo d -g`，即可完成博客在另一台电脑的克隆。

然而，这种方式的缺点也很明显，即多次备份，以使用U盘备份为例：

<!-- more -->

>* 我在公司写了`文章A`并发布（deploy），到家后如果写了`文章B`，这时不能直接发布博客，因为家里的本地是没有`文章A`的，这时发布会造成博客上已发布的`文章A`丢失，因此就需要把`文章A的备份`拷进去；好，那就把备份拷进去，然后`hexo d -g`，OK，新`文章B`上去了,已发布的`文章A`也没丢。
>* 到上面为止，一切都还能接受。
>* 但如果我第二天在公司上班突然来了灵感，利用业余时间在公司写了`文章C`呢？我需要重复第一步，把备份的`文章B`拷到公司本地的博客文章目录中，然后重复......

上面的例子是使用U盘备份，是一个比较极端的例子。更好的方法是新建另一个GitHub仓库保存备份整个hexo博客文件夹，每次更新不需要把U盘带来带去，也不需要`ctrl+c`、`ctrl+v`，而只需要`git pull`、`git push`，相当于每次在该仓库的最新版本上对博客进行维护更新，产生的新改动会在`hexo d -g`后于个人博客仓库生效。

作为一名程序员，优雅应当是天性，即使使用另一个GitHub仓库进行备份我依然觉得不够优雅，能不能只在个人博客仓库上面就做到满足这个场景呢？

于是我开始搜索资料，搜到了一个符合当前场景的解决方案，然而，试了该方案后，我悲哀的发现，这个解决方案已经过时了，不再符合当前的hexo版本*[注解1]*。

但是，天无绝人之路，方案不能全盘照搬，但是核心思想却是可行的，我的思路一下子被打开了——可以使用git分支来解决！使用个人博客仓库的`master`分支来保存博客静态页面，使用另一个分支来保存hexo部署目录！

话不多说，下面是我实践的方法：

一、准备工作
---

开始本教程之前，请确保你已经使用hexo在github pages上面部署好你的个人博客，并在本地电脑拥有该博客的部署环境，即类似于以下图片的文件目录（博客根目录）：

![hexo-github-pages博客部署环境文件目录](/images/9U31M0VVJ.png)

如果这一步还未完成，请自行搜索如何使用hexo搭建Github Pages个人博客，网上教程一大堆，不再赘述。

二、对username.github.io仓库新建分支，并克隆
---

有两种方式：

* 方式一：先把<code>*username*.github.io</code>仓库克隆到本地（不在hexo博客部署环境目录中，另起一个），然后进入<code>*username*.github.io</code>文件目录，在Git Bash中执行`git branch xxx`命令新建`xxx`分支，再使用`git checkout xxx`切换到该分支；

* 方式二：先在Github上可视化新建`xxx`分支，并切换到该分支，并在该仓库->Settings->Branches->Default branch中将默认分支设为`xxx`，save保存；然后将该仓库克隆到本地，并进入该<code>*username*.github.io</code>文件目录。

上面两种方式只是顺序的差异，本质上没有区别，我采用的是后者。

完成上面步骤后，在当前目录使用`git branch`命令查看当前所在分支，应为新建的分支`xxx`：

```bash
git branch
* xxx
```

三、将本地博客的部署文件拷贝进username.github.io文件目录
---

如题，先将本地博客的部署文件全部拷贝进username.github.io文件目录。

接下来，将拷贝进来的博客hexo部署环境提交到xxx分支，提交之前需注意：

>* 将`themes`目录以内中的主题的`.git`目录删除（如果有），因为一个git仓库中不能包含另一个git仓库，提交主题文件夹会失败。
>* 可能有人会问，删除了`themes`目录中的`.git`不就不能`git pull`更新主题了吗，很简单，需要更新主题时在另一个地方`git clone`下来该主题的最新版本，然后将内容拷到当前主题目录即可

四、提交xxx分支
---

在<code>*username*.github.io</code>目录使用Git Bash执行`git add .`、`git commit -m 'back up hexo files'`（引号内容可改）、`git push origin xxx`即可将博客的hexo部署环境提交到GitHub个人仓库的`xxx`分支了。

现在可以在GitHub上的<code>*username*.github.io</code>仓库看到两个分支的差异了。

`master`分支和`xxx`分支各自保存着一个版本，`master`分支用于保存博客静态资源，提供博客页面供人访问；`xxx`分支用于备份博客部署文件，供自己维护更新，两者在一个GitHub仓库内互不冲突，完美！

五、新电脑环境部署
---

至此，你的博客已经可以在其他电脑上进行同步的维护和更新了，方法很简单：

>* 将新电脑的生成的ssh key添加到GitHub账户上
>* 在新电脑上克隆<code>*username*.github.io</code>仓库的`xxx`分支到本地，此时本地git仓库处于`xxx`分支
>* 切换到<code>*username*.github.io</code>目录，执行`npm install`(由于仓库有一个`.gitignore`文件，里面默认是忽略掉`node_modules`文件夹的，也就是说仓库的hexo分支并没有存储该目录[也不需要]，所以需要install下)
>* 写新文章
>* 执行本教程第四步：**提交xxx分支**,保证分支版本最新
>* 执行`hexo d -g`指令（在此之前，有时可能需要执行`hexo clean`），完成后就会发现，最新改动已经更新到`master`分支了，两个分支互不干扰！

下次回到原来的电脑，再也不需要备份和拷贝了，只需要一次`git pull origin xxx`更新一下新电脑推送的最新版本，即可继续同步维护更新！

注意每次**换电脑进行博客更新**时，如果上次在其他电脑有更新，此时都需要先`pull`获取最新版本，之后再进行编辑和提交。

六、更加完美：设置默认分支
---

以上已经很完美了，但还不够尽善尽美！

因为我们平时更新博客，并不需要手动在`master`分支上进行git操作，只需要`hexo d -g`一把，即可完成博客更新。

也就是说，我们是不会用到`master`分支的，那就可以把每次`git push origin xxx`和`git pull origin xxx`中的分支`origin xxx`省去，直接将`xxx`设为默认分支，即只使用`git push`和`git pull`指令，多么令人愉悦的操作！

那么如何设置默认分支呢？




>*[注解1]*：我百度到的旧版本解决方案见：[使用hexo，如果换了电脑怎么更新博客？](https://www.zhihu.com/question/21193762)，有兴趣可以看看